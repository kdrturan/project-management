<div class="main-content">
  <div class="container">
    <!-- Header Section -->
    <div class="header">
      <div class="header-content">
        <div class="header-left">
          <h1>{{ project?.name || 'Proje Detaylarƒ±' }}</h1>
          <div class="project-meta">
            <span class="status-badge" [class]="'status-' + project?.status?.toLowerCase()">
              {{ project?.status || 'Durum Belirtilmemi≈ü' }}
            </span>
            <span class="priority-badge">
              {{ getPriorityLabel() }}
            </span>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn btn-secondary" (click)="goBack()">
            ‚Üê Geri D√∂n
          </button>
          <button class="btn btn-outline" (click)="copyProjectInfo()" *ngIf="!isEditMode">
            üìã Kopyala
          </button>
          <button class="btn btn-primary" (click)="toggleEditMode()" [disabled]="isLoading">
            <span *ngIf="isEditMode">‚ùå ƒ∞ptal Et</span>
            <span *ngIf="!isEditMode">‚úèÔ∏è D√ºzenle</span>
          </button>
          <button class="btn btn-danger" (click)="deleteProject()" *ngIf="!isEditMode" [disabled]="isLoading">
            üóëÔ∏è Sil
          </button>
        </div>
      </div>
    </div>

    <form [formGroup]="projectForm" (ngSubmit)="onSave()">
      <div class="content">
        <!-- Sol Panel - Proje Bilgileri -->
        <div class="detail-section">
          <div class="section-card">
            <h2>Proje Bilgileri</h2>
            
            <div class="form-group">
              <label>Proje Adƒ±</label>
              <input 
                type="text" 
                formControlName="name" 
                class="form-control" 
                [readonly]="!isEditMode"
                placeholder="Proje adƒ±nƒ± girin">
            </div>

            <div class="form-group">
              <label>Proje A√ßƒ±klamasƒ±</label>
              <textarea 
                formControlName="description" 
                class="form-control" 
                rows="4" 
                [readonly]="!isEditMode"
                placeholder="Proje a√ßƒ±klamasƒ±nƒ± girin..."></textarea>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Ba≈ülangƒ±√ß Tarihi</label>
                <input 
                  type="date" 
                  formControlName="plannedStartDate" 
                  class="form-control"
                  [readonly]="!isEditMode">
              </div>
              <div class="form-group">
                <label>Biti≈ü Tarihi</label>
                <input 
                  type="date" 
                  formControlName="plannedEndDate" 
                  class="form-control"
                  [readonly]="!isEditMode">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>√ñncelik Seviyesi</label>
                <!-- Edit mode'da select -->
                <select 
                  *ngIf="isEditMode"
                  formControlName="priority" 
                  class="form-control">
                  <option *ngFor="let priority of priorities" [value]="priority.value">
                    {{ priority.label }}
                  </option>
                </select>
                <!-- Read-only mode'da input -->
                <input 
                  *ngIf="!isEditMode"
                  type="text" 
                  class="form-control" 
                  [value]="getPriorityLabel()"
                  readonly>
              </div>
              <div class="form-group">
                <label>Durum</label>
                <!-- Edit mode'da select -->
                <select 
                  *ngIf="isEditMode"
                  formControlName="status" 
                  class="form-control">
                  <option *ngFor="let status of statuses" [value]="status.value">
                    {{ status.label }}
                  </option>
                </select>
                <!-- Read-only mode'da input -->
                <input 
                  *ngIf="!isEditMode"
                  type="text" 
                  class="form-control" 
                  [value]="getStatusLabel()"
                  readonly>
              </div>
            </div>

            <div class="form-group">
              <label>B√ºt√ße (‚Ç∫)</label>
              <input 
                type="number" 
                formControlName="budget" 
                class="form-control" 
                [readonly]="!isEditMode"
                placeholder="0.00">
            </div>

            <div class="form-group">
              <label>Proje Y√∂neticisi</label>
              <input 
                type="text" 
                [value]="project?.projectManagerName || 'Atanmamƒ±≈ü'"
                class="form-control" 
                readonly>
            </div>
          </div>

          <!-- Proje Dosyalarƒ± Expandable Section -->
          <div class="section-card expandable-section">
            <div class="expander-header" (click)="toggleFilesSection()" [class.expanded]="isFilesSectionExpanded">
              <span class="expander-icon" [class.expanded]="isFilesSectionExpanded">‚ñ∂</span>
              <h2 class="expander-title">Proje Dosyalarƒ±</h2>
              <span class="file-count">{{ (projectFiles.length + newFiles.length) }} dosya</span>
              <button 
                type="button" 
                class="btn btn-outline btn-sm" 
                (click)="addFiles($event)"
                *ngIf="isEditMode && isFilesSectionExpanded">
                üìé Dosya Ekle
              </button>
            </div>

            <div class="expander-content" [class.expanded]="isFilesSectionExpanded">
              <input 
                #fileInput 
                type="file" 
                multiple 
                accept=".pdf,.doc,.docx,.xls,.xlsx,.png,.jpg,.jpeg" 
                style="display: none;" 
                (change)="onFileSelected($event)">

              <!-- Yeni Eklenen Dosyalar -->
              <div class="file-section" *ngIf="newFiles.length > 0">
                <h4>Yeni Dosyalar</h4>
                <div class="file-list">
                  <div class="file-item new-file" *ngFor="let file of newFiles; let i = index">
                    <div class="file-info">
                      <span class="file-icon">{{ getFileIcon(file.name) }}</span>
                      <div class="file-details">
                        <div class="file-name">{{ file.name }}</div>
                        <div class="file-size">{{ formatFileSize(file.size) }}</div>
                      </div>
                    </div>
                    <button type="button" class="file-remove" (click)="removeNewFile(i)">√ó</button>
                  </div>
                </div>
              </div>

              <!-- Mevcut Dosyalar -->
              <div class="file-section" *ngIf="projectFiles.length > 0">
                <h4>Mevcut Dosyalar</h4>
                <div class="file-list">
                  <div class="file-item" *ngFor="let file of projectFiles; let i = index">
                    <div class="file-info">
                      <span class="file-icon">{{ getFileIcon(file.originalFilename) }}</span>
                      <div class="file-details">
                        <div class="file-name">{{ file.originalFilename }}</div>
                        <div class="file-size">{{ formatFileSize(file.fileSizeBytes) }}</div>
                        <div class="file-date">{{ formatDate(file.createdAt) }}</div>
                      </div>
                    </div>
                    <div class="file-actions">
                      <button type="button" class="btn-icon" (click)="downloadFile(file)" title="ƒ∞ndir">
                        üì•
                      </button>
                      <button 
                        type="button" 
                        class="btn-icon delete" 
                        (click)="deleteFile(file, i)" 
                        *ngIf="isEditMode"
                        title="Sil">
                        üóëÔ∏è
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="empty-state" *ngIf="projectFiles.length === 0 && newFiles.length === 0">
                <div class="empty-icon">üìÅ</div>
                <p>Hen√ºz dosya eklenmemi≈ü</p>
              </div>
            </div>
          </div>

          <!-- ƒ∞≈ü Paketleri Expandable Section -->
          <div class="section-card expandable-section">
            <div class="expander-header" (click)="toggleWorkPackagesSection()" [class.expanded]="isWorkPackagesSectionExpanded">
              <span class="expander-icon" [class.expanded]="isWorkPackagesSectionExpanded">‚ñ∂</span>
              <h2 class="expander-title">ƒ∞≈ü Paketleri</h2>
              <span class="workpackage-count">{{ projectWorkPackages.length }} paket</span>
              <button 
                type="button" 
                class="btn btn-outline btn-sm" 
                (click)="addWorkPackage($event)"
                *ngIf="isEditMode && isWorkPackagesSectionExpanded">
                üì¶ Yeni ƒ∞≈ü Paketi
              </button>
            </div>

            <div class="expander-content" [class.expanded]="isWorkPackagesSectionExpanded">
              <div class="workpackages-container">
                
                <!-- Yeni ƒ∞≈ü Paketleri Formu -->
                <div class="new-workpackages-section" *ngIf="newWorkPackages.length > 0 && isEditMode">
                  <h4>Yeni ƒ∞≈ü Paketleri</h4>
                  <div class="new-workpackage-list">
                    <div class="new-workpackage-item" *ngFor="let wp of newWorkPackages; let i = index">
                      <div class="workpackage-form-card">
                        <div class="workpackage-form-header">
                          <h5>Yeni ƒ∞≈ü Paketi {{ i + 1 }}</h5>
                          <button type="button" class="btn-remove-workpackage" (click)="removeNewWorkPackage(i)">√ó</button>
                        </div>
                        
                        <div class="workpackage-form-content">
                          <div class="form-group">
                            <label>ƒ∞≈ü Paketi Adƒ± *</label>
                            <input 
                              type="text" 
                              [(ngModel)]="wp.name" [ngModelOptions]="{standalone: true}"
                              class="form-control"
                              placeholder="ƒ∞≈ü paketi adƒ±nƒ± girin">
                          </div>

                          <div class="form-group">
                            <label>A√ßƒ±klama</label>
                            <textarea 
                              [(ngModel)]="wp.description" [ngModelOptions]="{standalone: true}"
                              class="form-control" 
                              rows="2"
                              placeholder="ƒ∞≈ü paketi a√ßƒ±klamasƒ±..."></textarea>
                          </div>

                          <div class="form-row">
                            <div class="form-group">
                              <label>Durum</label>
                              <select [(ngModel)]="wp.status" class="form-control" [ngModelOptions]="{standalone: true}"> 
                                <option value="Ba≈ülatƒ±lmadƒ±">Ba≈ülatƒ±lmadƒ±</option>
                                <option value="Devam Ediyor">Devam Ediyor</option>
                                <option value="Tamamlandƒ±">Tamamlandƒ±</option>
                                <option value="Beklemede">Beklemede</option>
                              </select>
                            </div>
                            <div class="form-group">
                              <label>Departman</label>
                              <select 
                                [(ngModel)]="wp.departmentId" 
                                [ngModelOptions]="{standalone: true}"
                                class="form-control"
                                placeholder="Departman se√ßin">
                                <option value="" disabled>Departman se√ßin</option>
                                <option 
                                  *ngFor="let department of departments" 
                                  [value]="department.id">
                                  {{ department.name }}
                                </option>
                              </select>
                            </div>
                          </div>

                          <div class="form-row">
                            <div class="form-group">
                              <label>Ba≈ülangƒ±√ß Tarihi</label>
                              <input 
                                type="date" 
                                [(ngModel)]="wp.plannedStartDate" [ngModelOptions]="{standalone: true}"
                                class="form-control">
                            </div>
                            <div class="form-group">
                              <label>Biti≈ü Tarihi</label>
                              <input 
                                type="date" 
                                [(ngModel)]="wp.plannedEndDate" [ngModelOptions]="{standalone: true}"
                                class="form-control">
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Mevcut ƒ∞≈ü Paketleri -->
                <div class="workpackage-list" *ngIf="projectWorkPackages.length > 0">
                  <h4 *ngIf="newWorkPackages.length > 0 && isEditMode">Mevcut ƒ∞≈ü Paketleri</h4>
                  <div class="workpackage-item" *ngFor="let wp of projectWorkPackages; let i = index">
                    
                    <!-- D√ºzenleme Modunda Deƒüilse (Normal G√∂r√ºn√ºm) -->
                    <div *ngIf="!editingWorkPackages[i]">
                      <div class="workpackage-header">
                        <div class="workpackage-info">
                          <div class="workpackage-name">{{ wp.name }}</div>
                          <div class="workpackage-description">{{ wp.description }}</div>
                        </div>
                        <div class="workpackage-actions">
                          <span class="workpackage-status" [ngClass]="getWorkPackageStatusClass(wp.status)">
                            {{ getWorkPackageStatusLabel(wp.status) }}
                          </span>
                          <!-- D√ºzenleme ve Silme Butonlarƒ± -->
                          <button 
                            type="button" 
                            class="btn-icon edit-btn" 
                            (click)="startEditingWorkPackage(wp, i)"
                            *ngIf="isEditMode"
                            title="D√ºzenle">
                            ‚úèÔ∏è
                          </button>
                          <button 
                            type="button" 
                            class="btn-icon delete-btn" 
                            (click)="deleteWorkPackage(wp, i)"
                            *ngIf="isEditMode"
                            title="Sil">
                            üóëÔ∏è
                          </button>
                        </div>
                      </div>
                      
                      <div class="workpackage-meta">
                        <div class="workpackage-dates">
                          <span class="date-item">
                            <span class="date-label">Ba≈ülangƒ±√ß:</span>
                            <span class="date-value">{{ wp.plannedStartDate ? formatDate(wp.plannedStartDate) : '-' }}</span>
                          </span>
                          <span class="date-item">
                            <span class="date-label">Biti≈ü:</span>
                            <span class="date-value">{{ wp.plannedEndDate ? formatDate(wp.plannedEndDate) : '-' }}</span>
                          </span>
                        </div>
                        <div class="workpackage-department" *ngIf="wp.departmentName">
                          <span>üè¢</span>
                          <span>{{ wp.departmentName }}</span>
                        </div>
                      </div>
                    </div>

                    <!-- D√ºzenleme Modunda (Form G√∂r√ºn√ºm√º) -->
                    <div *ngIf="editingWorkPackages[i]" class="workpackage-edit-form">
                      <div class="workpackage-form-header">
                        <h5>ƒ∞≈ü Paketini D√ºzenle</h5>
                        <div class="edit-actions">
                          <button type="button" class="btn btn-sm btn-primary" (click)="saveEditedWorkPackage(i)">
                            ‚úì Kaydet
                          </button>
                          <button type="button" class="btn btn-sm btn-secondary" (click)="cancelEditingWorkPackage(i)">
                            ‚úï ƒ∞ptal
                          </button>
                        </div>
                      </div>
                      
                      <div class="workpackage-form-content">
                        <div class="form-group">
                          <label>ƒ∞≈ü Paketi Adƒ± *</label>
                          <input 
                            type="text" 
                            [(ngModel)]="editedWorkPackages[i].name" 
                            [ngModelOptions]="{standalone: true}"
                            class="form-control"
                            placeholder="ƒ∞≈ü paketi adƒ±nƒ± girin">
                        </div>

                        <div class="form-group">
                          <label>A√ßƒ±klama</label>
                          <textarea 
                            [(ngModel)]="editedWorkPackages[i].description" 
                            [ngModelOptions]="{standalone: true}"
                            class="form-control" 
                            rows="2"
                            placeholder="ƒ∞≈ü paketi a√ßƒ±klamasƒ±..."></textarea>
                        </div>

                        <div class="form-row">
                          <div class="form-group">
                            <label>Durum</label>
                            <select [(ngModel)]="editedWorkPackages[i].status" class="form-control" [ngModelOptions]="{standalone: true}"> 
                              <option value="Ba≈ülatƒ±lmadƒ±">Ba≈ülatƒ±lmadƒ±</option>
                              <option value="Devam Ediyor">Devam Ediyor</option>
                              <option value="Tamamlandƒ±">Tamamlandƒ±</option>
                              <option value="Beklemede">Beklemede</option>
                            </select>
                          </div>
                          <div class="form-group">
                            <label>Departman</label>
                            <select 
                              [(ngModel)]="editedWorkPackages[i].departmentId" 
                              [ngModelOptions]="{standalone: true}"
                              class="form-control">
                              <option value="" disabled>Departman se√ßin</option>
                              <option 
                                *ngFor="let department of departments" 
                                [value]="department.id">
                                {{ department.name }}
                              </option>
                            </select>
                          </div>
                        </div>

                        <div class="form-row">
                          <div class="form-group">
                            <label>Ba≈ülangƒ±√ß Tarihi</label>
                            <input 
                              type="date" 
                              [(ngModel)]="editedWorkPackages[i].plannedStartDate" 
                              [ngModelOptions]="{standalone: true}"
                              class="form-control">
                          </div>
                          <div class="form-group">
                            <label>Biti≈ü Tarihi</label>
                            <input 
                              type="date" 
                              [(ngModel)]="editedWorkPackages[i].plannedEndDate" 
                              [ngModelOptions]="{standalone: true}"
                              class="form-control">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="empty-state" *ngIf="projectWorkPackages.length === 0 && newWorkPackages.length === 0">
                  <div class="empty-icon">üì¶</div>
                  <p>Bu projeye hen√ºz i≈ü paketi tanƒ±mlanmamƒ±≈ü</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Saƒü Panel - Proje ƒ∞statistikleri -->
        <div class="stats-section">
          <div class="stats-card">
            <h3>üìä Proje ƒ∞statistikleri</h3>
            
            <div class="stat-item">
              <span class="stat-label">Proje S√ºresi:</span>
              <span class="stat-value">{{ calculateDuration() }}</span>
            </div>
            
            <div class="stat-item">
              <span class="stat-label">Kalan S√ºre:</span>
              <span class="stat-value" [class]="getRemainingTimeClass()">
                {{ calculateRemainingTime() }}
              </span>
            </div>
            
            <div class="stat-item">
              <span class="stat-label">B√ºt√ße:</span>
              <span class="stat-value">{{ formatCurrency(projectForm.get('budget')?.value) }}</span>
            </div>
            
            <div class="stat-item">
              <span class="stat-label">Dosya Sayƒ±sƒ±:</span>
              <span class="stat-value">{{ projectFiles.length + newFiles.length }} dosya</span>
            </div>

            <div class="stat-item">
              <span class="stat-label">ƒ∞≈ü Paketleri:</span>
              <span class="stat-value">{{ projectWorkPackages.length }} paket</span>
            </div>
            
            <div class="stat-item">
              <span class="stat-label">Olu≈üturma Tarihi:</span>
              <span class="stat-value">{{ formatDate(project?.createdAt) }}</span>
            </div>
            
            <div class="stat-item">
              <span class="stat-label">Son G√ºncelleme:</span>
              <span class="stat-value">{{ formatDate(project?.updatedAt) }}</span>
            </div>
          </div>

          <!-- Proje Ge√ßmi≈üi -->
          <div class="stats-card">
            <h3>üìã Proje Ge√ßmi≈üi</h3>
			<div class="activity-item" 
				*ngFor="let historyItem of projectHistory" 
				(click)="historyItem.id && routeHistory(historyItem.id)">
			<div class="activity-icon">{{ getChangeIcon(historyItem.changeType) }}</div>
			<div class="activity-content">
				<div class="activity-text">Projenin {{ historyItem.versionNumber }}. versiyonu</div>
				<div class="activity-date">{{ formatDate(historyItem.updatedAt) }}</div>
			</div>
			</div>
            <div class="empty-state" *ngIf="projectHistory.length === 0">
              <p>Hen√ºz deƒüi≈üiklik ge√ßmi≈üi bulunmuyor</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons" *ngIf="isEditMode">
        <button type="button" class="btn btn-secondary" (click)="cancelEdit()">
          ƒ∞ptal Et
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="!projectForm.valid || isLoading">
          <span *ngIf="isLoading">‚è≥ Kaydediliyor...</span>
          <span *ngIf="!isLoading">‚úì Deƒüi≈üiklikleri Kaydet</span>
        </button>
      </div>
    </form>
  </div>
</div>