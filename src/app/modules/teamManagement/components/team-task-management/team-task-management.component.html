<div class="task-management-container">
  
  <!-- Header -->
  <div class="page-header">
    <div class="header-info">
      <h1>TakÄ±m GÃ¶rev YÃ¶netimi</h1>
      <p>TakÄ±mÄ±nÄ±za atanan gÃ¶revleri Ã¼yelerinize daÄŸÄ±tÄ±n ve takip edin</p>
    </div>
  </div>

  <!-- Stats Overview -->
  <div class="stats-overview">
    <div class="stat-card">
      <div class="stat-icon">ğŸ“‹</div>
      <div class="stat-info">
        <div class="stat-number">{{ unassignedTasks.length }}</div>
        <div class="stat-label">AtanmamÄ±ÅŸ GÃ¶rev</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ğŸ‘¤</div>
      <div class="stat-info">
        <div class="stat-number">{{ assignedTasks.length }}</div>
        <div class="stat-label">AtanmÄ±ÅŸ GÃ¶rev</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ğŸ‘¥</div>
      <div class="stat-info">
        <div class="stat-number">{{ teamMembers.length }}</div>
        <div class="stat-label">TakÄ±m Ãœyesi</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">âœ…</div>
      <div class="stat-info">
        <div class="stat-number">{{getDoneTasksCount()}}</div>
        <div class="stat-label">Tamamlanan</div>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
        <div class="filter-group">
      <label>Durum Filtresi:</label>
      <select [(ngModel)]="statusFilter" class="filter-select">
        <option value="all">TÃ¼mÃ¼</option>
        <option value="YapÄ±lacak">YapÄ±lacak</option>
        <option value="Devam Eden">Devam Eden</option>
        <option value="Ä°nceleme/Test">Ä°nceleme/Test</option>
        <option value="Engelli">Engelli</option>
        <option value="Tamamlanan">Tamamlanan</option>
      </select>
    </div>
    
    <div class="filter-group">
      <label>Ã–ncelik:</label>
      <select [(ngModel)]="priorityFilter" class="filter-select">
        <option value="all">TÃ¼mÃ¼</option>
        <option value="DÃ¼ÅŸÃ¼k">DÃ¼ÅŸÃ¼k</option>
        <option value="Orta">Orta</option>
        <option value="YÃ¼ksek">YÃ¼ksek</option>
        <option value="Kritik">Kritik</option>
      </select>
    </div>
    
    <div class="filter-group">
      <label>Atanan KiÅŸi:</label>
      <select [(ngModel)]="assigneeFilter" class="filter-select">
        <option value="all">TÃ¼mÃ¼</option>
        <option *ngFor="let member of teamMembers" [value]="member.id">
          {{ getUserFullName(member) }}
        </option>
      </select>
    </div>
  </div>

  <!-- Main Content Grid -->
  <div class="main-content-grid">
    
    <!-- AtanmamÄ±ÅŸ GÃ¶revler -->
    <div class="section unassigned-section">
      <div class="section-header">
        <h2>AtanmamÄ±ÅŸ GÃ¶revler</h2>
        <span class="task-count">{{ getFilteredUnassignedTasks().length }} gÃ¶rev</span>
      </div>
      
      <div class="tasks-list">
        <div *ngFor="let task of getFilteredUnassignedTasks()" class="task-card unassigned">
			<div class="task-header">
				<h3 class="task-title">{{ task.title }}</h3>
				<div class="task-badges">
				<span class="priority-badge" [style.background-color]="getPriorityColor(task.priority)">
					{{ task.priority }}
				</span>
				</div>
			</div>
			
			<div class="task-description">{{ task.description }}</div>
			
			<div class="task-meta">
				<div class="meta-item">
				<span class="meta-label">Proje:</span>
				<span class="meta-value">{{ task.projectName }}</span> <!-- Backend field -->
				</div>
				<div class="meta-item">
				<span class="meta-label">Ä°ÅŸ Paketi:</span>
				<span class="meta-value">{{ task.workPackageName }}</span> <!-- Backend field -->
				</div>
				<div class="meta-item">
				<span class="meta-label">Tahmini SÃ¼re:</span>
				<span class="meta-value">{{ task.estimatedEffort || 0 }} saat</span>
				</div>
				<div class="meta-item">
				<span class="meta-label">BitiÅŸ Tarihi:</span>
				<span class="meta-value">{{ formatDate(task.plannedEndDate) }}</span>
				</div>
			</div>
			
			<div class="task-actions">
				<button class="assign-btn" (click)="openAssignModal(task)">
				ğŸ‘¤ Ata
				</button>
			</div>
	 	</div>
        
        <div *ngIf="getFilteredUnassignedTasks().length === 0" class="empty-state">
          <div class="empty-icon">ğŸ‰</div>
          <h3>TÃ¼m gÃ¶revler atandÄ±!</h3>
          <p>Åu anda atanmamÄ±ÅŸ gÃ¶rev bulunmuyor.</p>
        </div>
      </div>
    </div>

    <!-- AtanmÄ±ÅŸ GÃ¶revler -->
    <div class="section assigned-section">
      <div class="section-header">
        <h2>AtanmÄ±ÅŸ GÃ¶revler</h2>
        <span class="task-count">{{ getFilteredAssignedTasks().length }} gÃ¶rev</span>
      </div>
      
      <div class="tasks-list">
        <div *ngFor="let task of getFilteredAssignedTasks()" class="task-card assigned">
          <div class="task-header">
            <h3 class="task-title">{{ task.title }}</h3>
            <div class="task-badges">
              <span class="status-badge" [style.background-color]="getStatusColor(task.status)">
                {{ task.status }}
              </span>
              <span class="priority-badge" [style.background-color]="getPriorityColor(task.priority)">
                {{ task.priority }}
              </span>
            </div>
          </div>
          
          <div class="task-description">{{ task.description }}</div>
          
          <div class="assigned-user">
            <div class="user-avatar">{{ task.assignedUser?.firstName?.[0] }}{{ task.assignedUser?.lastName?.[0] }}</div>
            <div class="user-info">
              <div class="user-name">{{ getUserFullName(task.assignedUser) }}</div>
              <div class="user-position">{{ task.assignedUser?.position }}</div>
            </div>
          </div>
          
          <div class="task-progress">
            <div class="progress-info">
              <span>Ä°lerleme: {{ task.actualEffort || 0 }}/{{ task.estimatedEffort || 0 }} saat</span>
              <span class="progress-percentage">
                {{ task.estimatedEffort ? ((task.actualEffort || 0) / task.estimatedEffort * 100).toFixed(0) : 0 }}%
              </span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" 
                   [style.width.%]="task.estimatedEffort ? ((task.actualEffort || 0) / task.estimatedEffort * 100) : 0">
              </div>
            </div>
          </div>
          
          <div class="task-meta">
            <div class="meta-item">
              <span class="meta-label">BaÅŸlama:</span>
              <span class="meta-value">{{ formatDate(task.actualStartDate || task.plannedStartDate) }}</span>
            </div>
            <div class="meta-item">
              <span class="meta-label">BitiÅŸ:</span>
              <span class="meta-value">{{ formatDate(task.plannedEndDate) }}</span>
            </div>
          </div>
          
			        <div class="task-actions">
          <div class="status-update">
            <label>Durum GÃ¼ncelle:</label>
            <select [(ngModel)]="task.status" 
                    (ngModelChange)="updateTaskStatus(task, $event)"
                    class="status-select">
              <option value="YapÄ±lacak">YapÄ±lacak</option>
              <option value="Devam Eden">Devam Eden</option>
              <option value="Ä°nceleme/Test">Ä°nceleme/Test</option>
              <option value="Engelli">Engelli</option>
              <option value="Tamamlanan">Tamamlanan</option>
            </select>
          </div>
        </div>
        </div>
        
        <div *ngIf="getFilteredAssignedTasks().length === 0" class="empty-state">
          <div class="empty-icon">ğŸ“</div>
          <h3>HenÃ¼z atanmÄ±ÅŸ gÃ¶rev yok</h3>
          <p>Soldaki listeden gÃ¶revleri takÄ±m Ã¼yelerinize atayÄ±n.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- TakÄ±m Ãœyeleri Ã–zeti -->
  <div class="team-summary">
    <h2>TakÄ±m Ãœyeleri Ä°ÅŸ YÃ¼kÃ¼</h2>
    <div class="team-members-grid">
      <div *ngFor="let member of teamMembers" class="member-card">
        <div class="member-avatar">{{ member.firstName[0] }}{{ member.lastName[0] }}</div>
        <div class="member-info">
          <h3>{{ getUserFullName(member) }}</h3>
          <div class="workload-info">
            <span class="workload-label">Ä°ÅŸ YÃ¼kÃ¼:</span>
            <span class="workload-value" 
                  [style.color]="getWorkloadStatus(member.currentWorkload).color">
              {{ member.currentWorkload || 0 }} saat
            </span>
            <span class="workload-status" 
                  [style.color]="getWorkloadStatus(member.currentWorkload).color">
              ({{ getWorkloadStatus(member.currentWorkload).text }})
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- GÃ¶rev Atama Modal -->
<div *ngIf="showAssignModal" class="modal-overlay" (click)="closeAssignModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>GÃ¶rev Ata</h2>
      <button class="close-btn" (click)="closeAssignModal()">Ã—</button>
    </div>
    
    <div class="modal-body">
      <div class="task-info">
        <h3>{{ selectedTask?.title }}</h3>
        <p>{{ selectedTask?.description }}</p>
        <div class="task-details">
          <span>Proje: {{ selectedTask?.project?.name }}</span>
          <span>Ä°ÅŸ Paketi: {{ selectedTask?.workPackage?.name }}</span>
          <span>Tahmini SÃ¼re: {{ selectedTask?.estimatedEffort || 0 }} saat</span>
          <span>Ã–ncelik: {{ selectedTask?.priority }}</span>
        </div>
      </div>
      
      <form [formGroup]="assignTaskForm" (ngSubmit)="assignTask()">
        <div class="form-group">
          <label>Atanacak KiÅŸi *</label>
          <select formControlName="assignedUserId" class="form-control">
            <option value="">SeÃ§iniz...</option>
            <option *ngFor="let member of teamMembers" [value]="member.id">
              {{ getUserFullName(member) }} - {{ member.position }}
              (Ä°ÅŸ YÃ¼kÃ¼: {{ member.currentWorkload || 0 }} saat)
            </option>
          </select>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label>BaÅŸlama Tarihi</label>
            <input type="date" formControlName="plannedStartDate" class="form-control">
          </div>
          <div class="form-group">
            <label>BitiÅŸ Tarihi</label>
            <input type="date" formControlName="plannedEndDate" class="form-control">
          </div>
        </div>
        
        <div class="form-group">
          <label>Notlar</label>
          <textarea formControlName="notes" 
                    class="form-control" 
                    rows="3" 
                    placeholder="GÃ¶rev hakkÄ±nda Ã¶zel notlarÄ±nÄ±z..."></textarea>
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" (click)="closeAssignModal()">
            Ä°ptal
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="!assignTaskForm.valid">
            Ata
          </button>
        </div>
      </form>
    </div>
  </div>
</div>